/ Page Content
= render partial: 'shared/maxbox_dependencies'
= javascript_include_tag('vehicle_manager')
.container-fluid
  .row
    .col-lg-5
      = form_tag search_vehicles_path, method: :get do
        .row
          .col-4
            .form-group
              = text_field_tag "stock_number", nil, class: 'form-control-sm form-control', placeholder: 'Search Stock #'
          .col-2
            = submit_tag 'Search', class: 'btn btn-primary btn-sm'
          .col-6.text-white.text-right.pt-1
            - grouped = @vehicles.group(:is_used).count
            %span.p-1.bg-blue.rounded
              = "New: #{grouped[false]}"
            %span.p-1.bg-green.rounded.ml-1
              = "Used: #{grouped[true]}"

      .table-responsive.vehicle-table
        %table.table.table-bordered.table-striped.table-sm
          %thead
            %tr
              %th Stock #
              %th Year
              %th Make
              %th Model
              %th Age
              
          %tbody.small
            - @vehicles.each do |vehicle|
              %tr{id: dom_id(vehicle)}
                %td= vehicle.stock_number
                %td
                  = vehicle.year
                %td
                  = link_to vehicle_path(vehicle), onclick: 'show_loading();', remote: true do
                    = vehicle.make
                %th
                  = link_to vehicle_path(vehicle), onclick: 'show_loading();', remote: true do
                    = vehicle.model
                %th
                  = time_ago_in_words(vehicle.created_at)
               
        = link_to "Add New Vehicle", new_vehicle_path, class: 'btn btn-small btn-primary'
      
    .col-md-7
      #vehicleDetailContainer

      / Modal
      #mapModal.modal{"aria-hidden" => "true", "aria-labelledby" => "exampleModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog.modal-lg{:role => "document"}
          .modal-content
            .modal-header
              %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
                %span{"aria-hidden" => "true"} Ã—
            .modal-body
              .row
                #map{ :style => "width: 100%; height: 400px" }        
                .d-none
                  //place all dom-dependent info here
                  %input#dealership_map_bearing{value: current_user.dealership.map_bearing }
                  %input#dealership_map_zoom{value: current_user.dealership.map_zoom }          
            .modal-footer
              %button.btn.btn-secondary{"data-dismiss" => "modal", :type => "button"} Close
      
:javascript
  $(function(){
    $('#mapModal').on('shown.bs.modal', function (event) {
      //the map was just shown, here we can extract just the vehicle in question. and render it to the map
      window.map.resize();
    }); 
  })

  function show_loading(){
    $('#vehicleDetailContainer').html('Loading...')
  }
           
