= render partial: 'shared/maxbox_dependencies'
= javascript_include_tag('lot_view')

.container-fluid
  .row
    .col-lg-4
      %h2.mt-3 Lot View
      %hr
      %ul.nav.nav-tabs{:role => "tablist"}
        %li.nav-item
          %a.nav-link.active{"data-toggle" => "tab", :href => "#today", :role => "tab"} Today
        %li.nav-item
          %a.nav-link{"data-toggle" => "tab", :href => "#last_day", :role => "tab"} Last 24 Hours
        
      / Tab panes
      .tab-content.mt-3
        #today.tab-pane.in.active{:role => "tabpanel"}
          %h5 Recent Activity (Today)
          - @users_with_today_events.each_with_index do |user, i|
            %div
              %strong
                - if i == 0
                  %i.fa.fa-star.text-success
                = user.full_name
              = user.events.group_by(&:event_type).map{|k, v| pluralize(v.count, k.humanize) }.join(', ')
        #last_day.tab-pane{:role => "tabpanel"}
          %h5 Recent Activity (24 hours)
          - @users_with_24h_events.each_with_index do |user, i|
            %div
              %strong
                - if i == 0
                  %i.fa.fa-star.text-success
                = user.full_name
              = user.events.group_by(&:event_type).map{|k, v| pluralize(v.count, k.humanize) }.join(', ')
      %hr.my-2 
      %hr.mt-2.mb-5
        

      %h5 Vehicles Currently Off Lot
      - @vehicles_off_lot.each do |vehicle|
        - event = vehicle.events.where('event_type': ['test_drive' ,'fuel_vehicle']).last

        %div.mb-2
          %strong
            = event.user.full_name
          started a #{event.event_type.humanize} on #{event.started_at.in_time_zone("Pacific Time (US & Canada)").strftime('%m/%d/%Y at %l:%M %p')}
          = link_to vehicle_path(vehicle), target: "_blank" do
            (#{vehicle.stock_number})
      
    .col-lg-8{style: 'position: relative;'}
      #vehicle_data_container
      #map{ :style => "width: 100%; height: 550px" }
      
      .d-none
        //place all dom-dependent info here
        %input#dealership_map_bearing{value: current_user.dealership.map_bearing }
        %input#dealership_map_zoom{value: current_user.dealership.map_zoom }  