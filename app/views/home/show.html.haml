= render partial: 'shared/maxbox_dependencies'
= javascript_include_tag('lot_view')

.container-fluid
  .row
    .col-lg-4
      %h2.mt-3 Lot View
      %hr
      %h5 Recent Activity (24 hours)
      - @users_with_events.each_with_index do |user, i|
        %strong
          - if i == 0
            %i.fa.fa-star.text-success
          = user.full_name
        = user.events.group_by(&:event_type).map{|k, v| pluralize(v.count, k.humanize) }.join(', ')
        %hr.my-2
      %h5 Vehicles Currently Off Lot
      - @vehicles_off_lot.each do |vehicle|
        %div.mb-2
          %strong= vehicle.stock_number
        
          = "#{vehicle.year} #{vehicle.make} #{vehicle.model}"
          started a #{vehicle.events.where('event_type': ['test_drive' ,'fuel_vehicle']).last.event_type.humanize} on #{vehicle.events.where('event_type': ['test_drive' ,'fuel_vehicle']).last.started_at.in_time_zone("Pacific Time (US & Canada)").strftime('%m/%d/%Y at %l:%M %p')}
        
    .col-lg-8{style: 'position: relative;'}
      #vehicle_data_container
      #map{ :style => "width: 100%; height: 550px" }
      
      .d-none
        //place all dom-dependent info here
        %input#dealership_map_bearing{value: current_user.dealership.map_bearing }
        %input#dealership_map_zoom{value: current_user.dealership.map_zoom }  